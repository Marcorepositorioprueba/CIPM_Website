<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benchmarking Automático - CIPM</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="stylesheet" href="assets/sub_menu_styles.css">
    <style>
        body {
            background-color: #e0e5ec;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-image: url('imagenes/efig2.jpg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
        }
        .site-header .top-bar {
            background-color: #ffffff;
            text-align: center;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .site-header .logo {
            max-height: 70px;
        }

        .main-content { max-width: 800px; margin: 2rem auto; padding: 2rem; }
        .benchmarking-container { background: #ffffff; border-radius: 20px; padding: 30px; box-shadow: 10px 10px 30px #bebebe, -10px -10px 30px #ffffff; }
        .benchmarking-header { text-align: center; margin-bottom: 30px; }
        .benchmarking-header h1 { font-size: 2.2rem; color: #003366; }
        .benchmarking-header p { color: #555; font-size: 1.1rem; }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; color: #333; margin-bottom: 8px; }
        .form-group select, .form-group input { width: 100%; box-sizing: border-box; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }

        .compare-btn { display: block; width: 100%; padding: 15px; border: none; border-radius: 12px; background: #007bff; color: white; font-size: 1.3rem; font-weight: 700; cursor: pointer; transition: background-color 0.3s ease; margin-top: 20px; }
        .compare-btn:hover { background: #0056b3; }

        #results-section { margin-top: 30px; display: none; text-align: center; }
        .comparison-result { font-size: 1.8rem; font-weight: bold; margin-bottom: 10px; }
        .comparison-result.above { color: #28a745; }
        .comparison-result.average { color: #007bff; }
        .comparison-result.below { color: #dc3545; }
        .comparison-details { color: #555; font-size: 1.1rem; }

        .chart-container { margin-top: 20px; }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="top-bar">
            <img src="imagenes/logo_cipm.png" alt="CIPM Logo" class="logo">
        </div>
        <nav class="toolbox-nav">
            <a href="caja_herramientas.html" class="back-link">❮ Caja de Herramientas</a>
            <div class="nav-links-container">
                <a href="caja_herramientas.html#eficiencia-administracion">Eficiencia en la administración</a>
                <a href="caja_herramientas.html#laboratorio-finanzas">Laboratorio de finanzas y proyectos</a>
                <a href="caja_herramientas.html#estrategia-comunicacion">Estrategia y comunicación política</a>
                <a href="caja_herramientas.html#unidad-analisis" class="active">Unidad de análisis e investigación</a>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="benchmarking-container">
            <div class="benchmarking-header">
                <h1>Benchmarking Automático</h1>
                <p>Compare los indicadores de su municipio con estándares de referencia.</p>
            </div>

            <div class="form-group">
                <label for="municipio-select">Municipio</label>
                <select id="municipio-select">
                    <option value="Acatlán">Acatlán</option><option value="Acaxochitlán">Acaxochitlán</option><option value="Actopan">Actopan</option><option value="Agua Blanca de Iturbide">Agua Blanca de Iturbide</option><option value="Ajacuba">Ajacuba</option><option value="Alfajayucan">Alfajayucan</option><option value="Almoloya">Almoloya</option><option value="Apan">Apan</option><option value="Atitalaquia">Atitalaquia</option><option value="Atlapexco">Atlapexco</option><option value="Atotonilco el Grande">Atotonilco el Grande</option><option value="Atotonilco de Tula">Atotonilco de Tula</option><option value="Calnali">Calnali</option><option value="Cardonal">Cardonal</option><option value="Cuautepec de Hinojosa">Cuautepec de Hinojosa</option><option value="Chapantongo">Chapantongo</option><option value="Chapulhuacán">Chapulhuacán</option><option value="Chilcuautla">Chilcuautla</option><option value="El Arenal">El Arenal</option><option value="Eloxochitlán">Eloxochitlán</option><option value="Emiliano Zapata">Emiliano Zapata</option><option value="Epazoyucan">Epazoyucan</option><option value="Francisco I. Madero">Francisco I. Madero</option><option value="Huasca de Ocampo">Huasca de Ocampo</option><option value="Huautla">Huautla</option><option value="Huazalingo">Huazalingo</option><option value="Huehuetla">Huehuetla</option><option value="Huejutla de Reyes">Huejutla de Reyes</option><option value="Huichapan">Huichapan</option><option value="Ixmiquilpan">Ixmiquilpan</option><option value="Jacala de Ledezma">Jacala de Ledezma</option><option value="Jaltocán">Jaltocán</option><option value="Juárez Hidalgo">Juárez Hidalgo</option><option value="La Misión">La Misión</option><option value="Lolotla">Lolotla</option><option value="Metepec">Metepec</n><option value="Metztitlán">Metztitlán</option><option value="Mineral del Chico">Mineral del Chico</option><option value="Mineral del Monte">Mineral del Monte</option><option value="Mineral de la Reforma">Mineral de la Reforma</option><option value="Mixquiahuala de Juárez">Mixquiahuala de Juárez</option><option value="Molango de Escamilla">Molango de Escamilla</option><option value="Nicolás Flores">Nicolás Flores</option><option value="Nopala de Villagrán">Nopala de Villagrán</option><option value="Omitlán de Juárez">Omitlán de Juárez</option><option value="Pacula">Pacula</option><option value="Pachuca de Soto">Pachuca de Soto</option><option value="Pisaflores">Pisaflores</option><option value="Progreso de Obregón">Progreso de Obregón</option><option value="San Agustín Metzquititlán">San Agustín Metzquititlán</option><option value="San Agustín Tlaxiaca">San Agustín Tlaxiaca</option><option value="San Bartolo Tutotepec">San Bartolo Tutotepec</option><option value="San Felipe Orizatlán">San Felipe Orizatlán</option><option value="San Salvador">San Salvador</option><option value="Santiago de Anaya">Santiago de Anaya</option><option value="Santiago Tulantepec de Lugo Guerrero">Santiago Tulantepec de Lugo Guerrero</option><option value="Singuilucan">Singuilucan</option><option value="Tasquillo">Tasquillo</option><option value="Tecozautla">Tecozautla</option><option value="Tenango de Doria">Tenango de Doria</option><option value="Tepeapulco">Tepeapulco</option><option value="Tepehuacán de Guerrero">Tepehuacán de Guerrero</option><option value="Tepeji del Río de Ocampo">Tepeji del Río de Ocampo</option><option value="Tepetitlán">Tepetitlán</option><option value="Tetepango">Tetepango</option><option value="Tezontepec de Aldama">Tezontepec de Aldama</option><option value="Tianguistengo">Tianguistengo</option><option value="Tizayuca">Tizayuca</option><option value="Tlahuelilpan">Tlahuelilpan</option><option value="Tlahuiltepa">Tlahuiltepa</option><option value="Tlanalapa">Tlanalapa</option><option value="Tlanchinol">Tlanchinol</option><option value="Tlaxcoapan">Tlaxcoapan</option><option value="Tolcayuca">Tolcayuca</option><option value="Tula de Allende">Tula de Allende</option><option value="Tulancingo de Bravo">Tulancingo de Bravo</option><option value="Villa de Tezontepec">Villa de Tezontepec</option><option value="Xochiatipan">Xochiatipan</option><option value="Xochicoatlán">Xochicoatlán</option><option value="Yahualica">Yahualica</option><option value="Zacualtipán de Ángeles">Zacualtipán de Ángeles</option><option value="Zapotlán de Juárez">Zapotlán de Juárez</option><option value="Zempoala">Zempoala</option><option value="Zimapán">Zimapán</option>
                </select>
            </div>

            <div class="form-group">
                <label for="indicator-select">Seleccione el Indicador a Comparar</label>
                <select id="indicator-select">
                    <option value="recaudacion_per_capita">Recaudación per cápita ($)</option>
                    <option value="gasto_seguridad">Gasto en Seguridad per cápita ($)</option>
                    <option value="inversion_infraestructura">Inversión en Infraestructura per cápita ($)</option>
                    <option value="porcentaje_agua_potable">% de Cobertura de Agua Potable</option>
                </select>
            </div>

            <div class="form-group">
                <label for="municipio-value">Valor de su Municipio</label>
                <input type="number" id="municipio-value" placeholder="Ej: 1500">
            </div>

            <button id="compare-btn" class="compare-btn">Comparar</button>

            <div id="results-section">
                <h3>Resultado del Benchmarking:</h3>
                <div class="comparison-result" id="comparison-result"></div>
                <p class="comparison-details" id="comparison-details"></p>
                <div class="chart-container">
                    <canvas id="benchmarking-chart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const compareBtn = document.getElementById('compare-btn');
            const municipioSelect = document.getElementById('municipio-select');
            const indicatorSelect = document.getElementById('indicator-select');
            const municipioValueInput = document.getElementById('municipio-value');
            const resultsSection = document.getElementById('results-section');
            const comparisonResultDiv = document.getElementById('comparison-result');
            const comparisonDetailsP = document.getElementById('comparison-details');
            let benchmarkingChart;

            const municipios = ["Acatlán", "Acaxochitlán", "Actopan", "Agua Blanca de Iturbide", "Ajacuba", "Alfajayucan", "Almoloya", "Apan", "Atitalaquia", "Atlapexco", "Atotonilco el Grande", "Atotonilco de Tula", "Calnali", "Cardonal", "Cuautepec de Hinojosa", "Chapantongo", "Chapulhuacán", "Chilcuautla", "El Arenal", "Eloxochitlán", "Emiliano Zapata", "Epazoyucan", "Francisco I. Madero", "Huasca de Ocampo", "Huautla", "Huazalingo", "Huehuetla", "Huejutla de Reyes", "Huichapan", "Ixmiquilpan", "Jacala de Ledezma", "Jaltocán", "Juárez Hidalgo", "La Misión", "Lolotla", "Metepec", "Metztitlán", "Mineral del Chico", "Mineral del Monte", "Mineral de la Reforma", "Mixquiahuala de Juárez", "Molango de Escamilla", "Nicolás Flores", "Nopala de Villagrán", "Omitlán de Juárez", "Pacula", "Pachuca de Soto", "Pisaflores", "Progreso de Obregón", "San Agustín Metzquititlán", "San Agustín Tlaxiaca", "San Bartolo Tutotepec", "San Felipe Orizatlán", "San Salvador", "Santiago de Anaya", "Santiago Tulantepec de Lugo Guerrero", "Singuilucan", "Tasquillo", "Tecozautla", "Tenango de Doria", "Tepeapulco", "Tepehuacán de Guerrero", "Tepeji del Río de Ocampo", "Tepetitlán", "Tetepango", "Tezontepec de Aldama", "Tianguistengo", "Tizayuca", "Tlahuelilpan", "Tlahuiltepa", "Tlanalapa", "Tlanchinol", "Tlaxcoapan", "Tolcayuca", "Tula de Allende", "Tulancingo de Bravo", "Villa de Tezontepec", "Xochiatipan", "Xochicoatlán", "Yahualica", "Zacualtipán de Ángeles", "Zapotlán de Juárez", "Zempoala", "Zimapán"];

            function populateSelect(selectElement, options) {
                options.forEach(optionText => {
                    const option = document.createElement('option');
                    option.value = optionText;
                    option.textContent = optionText;
                    selectElement.appendChild(option);
                });
            }

            populateSelect(municipioSelect, municipios);

            const referenceValues = {
                recaudacion_per_capita: { value: 1200, unit: '$', description: 'Promedio nacional de recaudación per cápita.' },
                gasto_seguridad: { value: 800, unit: '$', description: 'Gasto promedio en seguridad por habitante.' },
                inversion_infraestructura: { value: 2000, unit: '$', description: 'Inversión promedio en infraestructura por habitante.' },
                porcentaje_agua_potable: { value: 95, unit: '%', description: 'Porcentaje promedio de cobertura de agua potable.' }
            };

            compareBtn.addEventListener('click', () => {
                const selectedIndicator = indicatorSelect.value;
                const municipioValue = parseFloat(municipioValueInput.value);

                if (isNaN(municipioValue) || municipioValue < 0) {
                    alert('Por favor, ingrese un valor válido para su municipio.');
                    return;
                }

                const reference = referenceValues[selectedIndicator];
                let comparisonText = '';
                let comparisonClass = '';

                if (selectedIndicator === 'porcentaje_agua_potable') {
                    if (municipioValue >= reference.value) {
                        comparisonText = '¡Excelente! Por encima o igual al promedio.';
                        comparisonClass = 'above';
                    } else if (municipioValue >= (reference.value * 0.9)) {
                        comparisonText = 'Cerca del promedio. Buen desempeño.';
                        comparisonClass = 'average';
                    } else {
                        comparisonText = 'Por debajo del promedio. Oportunidad de mejora.';
                        comparisonClass = 'below';
                    }
                } else { // Para indicadores monetarios
                    if (municipioValue >= reference.value) {
                        comparisonText = '¡Excelente! Por encima o igual al promedio.';
                        comparisonClass = 'above';
                    } else if (municipioValue >= (reference.value * 0.8)) {
                        comparisonText = 'Cerca del promedio. Buen desempeño.';
                        comparisonClass = 'average';
                    } else {
                        comparisonText = 'Por debajo del promedio. Oportunidad de mejora.';
                        comparisonClass = 'below';
                    }
                }

                comparisonResultDiv.textContent = comparisonText;
                comparisonResultDiv.className = `comparison-result ${comparisonClass}`;
                comparisonDetailsP.textContent = `Su municipio: ${municipioValue}${reference.unit} | Referencia: ${reference.value}${reference.unit}. ${reference.description}`;

                // Update Chart
                const ctx = document.getElementById('benchmarking-chart').getContext('2d');
                if (benchmarkingChart) benchmarkingChart.destroy();

                benchmarkingChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Su Municipio', 'Referencia'],
                        datasets: [{
                            label: indicatorSelect.options[indicatorSelect.selectedIndex].text,
                            data: [municipioValue, reference.value],
                            backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(255, 99, 132, 0.6)'],
                            borderColor: ['rgba(54, 162, 235, 1)', 'rgba(255, 99, 132, 1)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { title: { display: true, text: 'Comparación de Indicadores' } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return `${value}${reference.unit}`;
                                    }
                                }
                            }
                        }
                    }
                });

                resultsSection.style.display = 'block';
            });
        });
    </script>
</body>
</html>